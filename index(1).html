<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Financeiro Pessoal - Completo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --color-primary: #33808d;
            --color-primary-hover: #1d7480;
            --color-background: #fcfcf9;
            --color-surface: #fffffe;
            --color-text: #13343b;
            --color-text-secondary: #626c71;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-success: #33808d;
            --color-warning: #e68161;
            --color-error: #c0152f;
            --color-card-bg: #fffffe;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: #1f2121;
                --color-surface: #262828;
                --color-text: #f5f5f5;
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-border: rgba(119, 124, 124, 0.3);
                --color-card-bg: #262828;
                --color-primary: #32b8c6;
                --color-primary-hover: #2da6b2;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: var(--color-primary);
            font-size: 2.2em;
        }

        .subtitle {
            text-align: center;
            color: var(--color-text-secondary);
            margin-bottom: 30px;
            font-size: 1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--color-border);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            color: var(--color-primary);
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--color-card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
        }

        .card h2 {
            color: var(--color-primary);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .card h3 {
            color: var(--color-text);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--color-text);
            font-size: 0.9em;
        }

        input[type="number"],
        input[type="text"],
        input[type="date"],
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 1em;
            background: var(--color-surface);
            color: var(--color-text);
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .btn {
            background: var(--color-primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: background 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-text-secondary);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: var(--color-text);
        }

        .btn-danger {
            background: var(--color-error);
            padding: 8px 16px;
            font-size: 0.9em;
            width: auto;
            margin-top: 0;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            width: auto;
            margin-top: 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--color-card-bg);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--color-border);
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--color-primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--color-text-secondary);
            font-size: 0.9em;
        }

        .advice-list {
            list-style: none;
            padding: 0;
        }

        .advice-item {
            padding: 15px;
            margin-bottom: 10px;
            background: var(--color-surface);
            border-left: 4px solid var(--color-primary);
            border-radius: 6px;
        }

        .advice-item.warning {
            border-left-color: var(--color-warning);
        }

        .advice-item.success {
            border-left-color: var(--color-success);
        }

        .chart-container {
            position: relative;
            height: 350px;
            margin: 20px 0;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--color-surface);
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        .expense-info {
            flex: 1;
        }

        .expense-category {
            font-weight: 500;
            color: var(--color-text);
        }

        .expense-date {
            font-size: 0.85em;
            color: var(--color-text-secondary);
        }

        .expense-amount {
            font-weight: bold;
            color: var(--color-primary);
            margin: 0 15px;
        }

        .hidden {
            display: none;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        .comparison-table th {
            background: var(--color-surface);
            font-weight: 600;
            color: var(--color-text);
        }

        .comparison-table tr:hover {
            background: var(--color-surface);
        }

        .percentage-bar {
            height: 8px;
            background: var(--color-border);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .percentage-fill {
            height: 100%;
            background: var(--color-primary);
            transition: width 0.3s;
        }

        .goal-card {
            background: var(--color-surface);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            margin-bottom: 15px;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-name {
            font-weight: 600;
            color: var(--color-text);
        }

        .goal-progress {
            font-size: 0.9em;
            color: var(--color-text-secondary);
        }

        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .two-columns {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
            }

            .tab-btn {
                white-space: nowrap;
            }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: rgba(51, 128, 141, 0.1);
            border: 1px solid var(--color-success);
            color: var(--color-success);
        }

        .alert-warning {
            background: rgba(230, 129, 97, 0.1);
            border: 1px solid var(--color-warning);
            color: var(--color-warning);
        }

        .projection-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .projection-table th,
        .projection-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--color-border);
        }

        .projection-table th {
            background: var(--color-surface);
            font-weight: 600;
        }

        .positive {
            color: var(--color-success);
        }

        .negative {
            color: var(--color-error);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Gestor Financeiro Pessoal</h1>
        <p class="subtitle">Gerencie suas finan√ßas de forma inteligente e alcance seus objetivos</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('input')">üìù Dados Iniciais</button>
            <button class="tab-btn" onclick="showTab('analysis')">üìä An√°lise</button>
            <button class="tab-btn" onclick="showTab('expenses')">üí∏ Despesas</button>
            <button class="tab-btn" onclick="showTab('goals')">üéØ Objetivos</button>
            <button class="tab-btn" onclick="showTab('projection')">üìà Proje√ß√µes</button>
            <button class="tab-btn" onclick="showTab('simulator')">üîÆ Simulador</button>
        </div>

        <!-- TAB 1: Dados Iniciais -->
        <div id="input" class="tab-content active">
            <div class="card">
                <h2>Informa√ß√µes Financeiras</h2>
                
                <div class="form-group">
                    <label for="salary">Ordenado Mensal (‚Ç¨)</label>
                    <input type="number" id="salary" placeholder="Ex: 1500" min="0" step="0.01">
                </div>

                <h3>Despesas Fixas Mensais</h3>
                <div class="two-columns">
                    <div class="form-group">
                        <label for="rent">Renda/Presta√ß√£o Casa (‚Ç¨)</label>
                        <input type="number" id="rent" placeholder="Ex: 500" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="utilities">√Ågua, Luz, G√°s (‚Ç¨)</label>
                        <input type="number" id="utilities" placeholder="Ex: 80" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="internet">Internet/Telem√≥vel (‚Ç¨)</label>
                        <input type="number" id="internet" placeholder="Ex: 40" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="transport">Transporte (‚Ç¨)</label>
                        <input type="number" id="transport" placeholder="Ex: 60" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="insurance">Seguros (‚Ç¨)</label>
                        <input type="number" id="insurance" placeholder="Ex: 30" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="loans">Empr√©stimos/Cr√©ditos (‚Ç¨)</label>
                        <input type="number" id="loans" placeholder="Ex: 100" min="0" step="0.01">
                    </div>
                </div>

                <h3>Despesas Vari√°veis Mensais</h3>
                <div class="two-columns">
                    <div class="form-group">
                        <label for="food">Alimenta√ß√£o (‚Ç¨)</label>
                        <input type="number" id="food" placeholder="Ex: 300" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="health">Sa√∫de/Farm√°cia (‚Ç¨)</label>
                        <input type="number" id="health" placeholder="Ex: 50" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="education">Educa√ß√£o (‚Ç¨)</label>
                        <input type="number" id="education" placeholder="Ex: 0" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="clothing">Vestu√°rio (‚Ç¨)</label>
                        <input type="number" id="clothing" placeholder="Ex: 50" min="0" step="0.01">
                    </div>
                </div>

                <h3>Gastos Sup√©rfluos/Lazer</h3>
                <div class="two-columns">
                    <div class="form-group">
                        <label for="entertainment">Entretenimento/Streaming (‚Ç¨)</label>
                        <input type="number" id="entertainment" placeholder="Ex: 30" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="restaurants">Restaurantes/Caf√©s (‚Ç¨)</label>
                        <input type="number" id="restaurants" placeholder="Ex: 100" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="hobbies">Hobbies (‚Ç¨)</label>
                        <input type="number" id="hobbies" placeholder="Ex: 50" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="other">Outros Gastos (‚Ç¨)</label>
                        <input type="number" id="other" placeholder="Ex: 50" min="0" step="0.01">
                    </div>
                </div>

                <button class="btn" onclick="calculateFinances()">Calcular e Analisar</button>
            </div>
        </div>

        <!-- TAB 2: An√°lise -->
        <div id="analysis" class="tab-content">
            <div id="results" class="hidden">
                <div class="grid">
                    <div class="stat-card">
                        <div class="stat-label">Ordenado Mensal</div>
                        <div class="stat-value" id="stat-salary">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total de Despesas</div>
                        <div class="stat-value" id="stat-expenses">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Sobra Mensal</div>
                        <div class="stat-value" id="stat-remaining">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Taxa de Poupan√ßa</div>
                        <div class="stat-value" id="stat-savings-rate">0%</div>
                    </div>
                </div>

                <div class="card">
                    <h2>Compara√ß√£o: Actual vs Recomendado</h2>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Actual (%)</th>
                                <th>Recomendado (%)</th>
                                <th>Diferen√ßa</th>
                            </tr>
                        </thead>
                        <tbody id="comparison-body">
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h2>Distribui√ß√£o Actual</h2>
                    <div class="chart-container">
                        <canvas id="currentChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h2>Compara√ß√£o Visual</h2>
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h2>Recomenda√ß√µes Personalizadas</h2>
                    <ul class="advice-list" id="advice-list"></ul>
                </div>
            </div>

            <div id="no-data" class="card">
                <p style="text-align: center; color: var(--color-text-secondary);">
                    Preencha os dados na aba "Dados Iniciais" para ver a an√°lise.
                </p>
            </div>
        </div>

        <!-- TAB 3: Despesas -->
        <div id="expenses" class="tab-content">
            <div class="card">
                <h2>Registo de Despesas</h2>
                <div class="two-columns">
                    <div class="form-group">
                        <label for="expense-description">Descri√ß√£o</label>
                        <input type="text" id="expense-description" placeholder="Ex: Jantar no restaurante">
                    </div>
                    <div class="form-group">
                        <label for="expense-amount">Valor (‚Ç¨)</label>
                        <input type="number" id="expense-amount" placeholder="Ex: 45.50" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="expense-category">Categoria</label>
                        <select id="expense-category">
                            <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                            <option value="Transporte">Transporte</option>
                            <option value="Sa√∫de">Sa√∫de</option>
                            <option value="Habita√ß√£o">Habita√ß√£o</option>
                            <option value="Lazer">Lazer</option>
                            <option value="Educa√ß√£o">Educa√ß√£o</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expense-date">Data</label>
                        <input type="date" id="expense-date">
                    </div>
                </div>
                <button class="btn" onclick="addExpense()">Adicionar Despesa</button>
            </div>

            <div class="card">
                <h2>Hist√≥rico de Despesas</h2>
                <div id="expense-list">
                    <p style="text-align: center; color: var(--color-text-secondary);">
                        Nenhuma despesa registada ainda.
                    </p>
                </div>
                <div style="margin-top: 20px;">
                    <strong>Total Gasto: <span id="total-expenses">‚Ç¨0.00</span></strong>
                </div>
            </div>

            <div class="card">
                <h2>Despesas por Categoria</h2>
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>

        <!-- TAB 4: Objetivos -->
        <div id="goals" class="tab-content">
            <div class="card">
                <h2>Criar Objetivo Financeiro</h2>
                <div class="form-group">
                    <label for="goal-name">Nome do Objetivo</label>
                    <input type="text" id="goal-name" placeholder="Ex: Comprar carro">
                </div>
                <div class="two-columns">
                    <div class="form-group">
                        <label for="goal-amount">Valor Necess√°rio (‚Ç¨)</label>
                        <input type="number" id="goal-amount" placeholder="Ex: 15000" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="goal-saved">J√° Poupado (‚Ç¨)</label>
                        <input type="number" id="goal-saved" placeholder="Ex: 2000" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="goal-monthly">Poupan√ßa Mensal (‚Ç¨)</label>
                        <input type="number" id="goal-monthly" placeholder="Ex: 300" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="goal-deadline">Data Alvo</label>
                        <input type="date" id="goal-deadline">
                    </div>
                </div>
                <button class="btn" onclick="addGoal()">Adicionar Objetivo</button>
            </div>

            <div class="card">
                <h2>Meus Objetivos</h2>
                <div id="goals-list">
                    <p style="text-align: center; color: var(--color-text-secondary);">
                        Nenhum objetivo definido ainda.
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB 5: Proje√ß√µes -->
        <div id="projection" class="tab-content">
            <div class="card">
                <h2>Proje√ß√£o Anual</h2>
                <p style="margin-bottom: 20px;">Baseado nos seus dados actuais, veja como ser√° o seu ano financeiro:</p>
                
                <div class="grid">
                    <div class="stat-card">
                        <div class="stat-label">Rendimento Anual</div>
                        <div class="stat-value positive" id="proj-income">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Despesas Anuais</div>
                        <div class="stat-value negative" id="proj-expenses">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Poupan√ßa Anual</div>
                        <div class="stat-value positive" id="proj-savings">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Investimento Anual</div>
                        <div class="stat-value positive" id="proj-investment">‚Ç¨0</div>
                    </div>
                </div>

                <h3>Proje√ß√£o Mensal (12 meses)</h3>
                <table class="projection-table">
                    <thead>
                        <tr>
                            <th>M√™s</th>
                            <th>Rendimento</th>
                            <th>Despesas</th>
                            <th>Poupan√ßa</th>
                            <th>Saldo Acumulado</th>
                        </tr>
                    </thead>
                    <tbody id="projection-table-body">
                    </tbody>
                </table>

                <div class="card">
                    <h3>Evolu√ß√£o do Saldo</h3>
                    <div class="chart-container">
                        <canvas id="projectionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 6: Simulador -->
        <div id="simulator" class="tab-content">
            <div class="card">
                <h2>Simulador de Cen√°rios</h2>
                <p style="margin-bottom: 20px;">Simule mudan√ßas nas suas finan√ßas e veja o impacto a longo prazo:</p>

                <div class="two-columns">
                    <div class="form-group">
                        <label for="sim-salary-change">Mudan√ßa no Ordenado (%)</label>
                        <input type="number" id="sim-salary-change" placeholder="Ex: 10 para aumento de 10%" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="sim-expense-change">Mudan√ßa nas Despesas (%)</label>
                        <input type="number" id="sim-expense-change" placeholder="Ex: -15 para reduzir 15%" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="sim-new-expense">Nova Despesa Mensal (‚Ç¨)</label>
                        <input type="number" id="sim-new-expense" placeholder="Ex: 200" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="sim-months">Per√≠odo (meses)</label>
                        <input type="number" id="sim-months" placeholder="Ex: 12" min="1" max="120" value="12">
                    </div>
                </div>

                <button class="btn" onclick="runSimulation()">Simular Cen√°rio</button>
            </div>

            <div id="simulation-results" class="hidden">
                <div class="grid">
                    <div class="stat-card">
                        <div class="stat-label">Cen√°rio Actual</div>
                        <div class="stat-value" id="sim-current">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Novo Cen√°rio</div>
                        <div class="stat-value" id="sim-new">‚Ç¨0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Diferen√ßa</div>
                        <div class="stat-value" id="sim-diff">‚Ç¨0</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Compara√ß√£o de Cen√°rios</h3>
                    <div class="chart-container">
                        <canvas id="simulationChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>An√°lise do Impacto</h3>
                    <div id="simulation-advice"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado global
        let financialData = null;
        let expenses = [];
        let goals = [];
        let charts = {};

        // Navega√ß√£o entre tabs
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Atualizar proje√ß√µes quando abrir a tab
            if (tabName === 'projection' && financialData) {
                updateProjections();
            }
        }

        // Definir data actual no input de despesas
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expense-date').value = today;
        });

        // Fun√ß√£o principal de c√°lculo
        function calculateFinances() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            
            if (salary === 0) {
                alert('Por favor, insira o seu ordenado mensal.');
                return;
            }

            // Despesas fixas
            const rent = parseFloat(document.getElementById('rent').value) || 0;
            const utilities = parseFloat(document.getElementById('utilities').value) || 0;
            const internet = parseFloat(document.getElementById('internet').value) || 0;
            const transport = parseFloat(document.getElementById('transport').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const loans = parseFloat(document.getElementById('loans').value) || 0;

            // Despesas vari√°veis
            const food = parseFloat(document.getElementById('food').value) || 0;
            const health = parseFloat(document.getElementById('health').value) || 0;
            const education = parseFloat(document.getElementById('education').value) || 0;
            const clothing = parseFloat(document.getElementById('clothing').value) || 0;

            // Gastos sup√©rfluos
            const entertainment = parseFloat(document.getElementById('entertainment').value) || 0;
            const restaurants = parseFloat(document.getElementById('restaurants').value) || 0;
            const hobbies = parseFloat(document.getElementById('hobbies').value) || 0;
            const other = parseFloat(document.getElementById('other').value) || 0;

            const essentials = rent + utilities + internet + transport + insurance + loans + food + health + education + clothing;
            const nonEssentials = entertainment + restaurants + hobbies + other;
            const totalExpenses = essentials + nonEssentials;
            const remaining = salary - totalExpenses;

            financialData = {
                salary,
                essentials,
                nonEssentials,
                totalExpenses,
                remaining,
                essentialsPercent: (essentials / salary) * 100,
                nonEssentialsPercent: (nonEssentials / salary) * 100,
                savingsPercent: (remaining / salary) * 100
            };

            displayResults();
            showTab('analysis');
        }

        function displayResults() {
            document.getElementById('no-data').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');

            // Estat√≠sticas
            document.getElementById('stat-salary').textContent = `‚Ç¨${financialData.salary.toFixed(2)}`;
            document.getElementById('stat-expenses').textContent = `‚Ç¨${financialData.totalExpenses.toFixed(2)}`;
            document.getElementById('stat-remaining').textContent = `‚Ç¨${financialData.remaining.toFixed(2)}`;
            document.getElementById('stat-savings-rate').textContent = `${financialData.savingsPercent.toFixed(1)}%`;

            // Tabela comparativa
            const comparisonBody = document.getElementById('comparison-body');
            comparisonBody.innerHTML = `
                <tr>
                    <td>Despesas Essenciais</td>
                    <td>${financialData.essentialsPercent.toFixed(1)}%</td>
                    <td>70%</td>
                    <td class="${financialData.essentialsPercent <= 70 ? 'positive' : 'negative'}">
                        ${(financialData.essentialsPercent - 70).toFixed(1)}%
                    </td>
                </tr>
                <tr>
                    <td>Poupan√ßa/Investimento</td>
                    <td>${financialData.savingsPercent.toFixed(1)}%</td>
                    <td>20%</td>
                    <td class="${financialData.savingsPercent >= 20 ? 'positive' : 'negative'}">
                        ${(financialData.savingsPercent - 20).toFixed(1)}%
                    </td>
                </tr>
                <tr>
                    <td>Gastos Sup√©rfluos</td>
                    <td>${financialData.nonEssentialsPercent.toFixed(1)}%</td>
                    <td>10%</td>
                    <td class="${financialData.nonEssentialsPercent <= 10 ? 'positive' : 'negative'}">
                        ${(financialData.nonEssentialsPercent - 10).toFixed(1)}%
                    </td>
                </tr>
            `;

            // Gr√°ficos
            createCharts();

            // Conselhos
            generateAdvice();
        }

        function createCharts() {
            // Gr√°fico da distribui√ß√£o actual
            const currentCtx = document.getElementById('currentChart');
            if (charts.current) charts.current.destroy();
            
            charts.current = new Chart(currentCtx, {
                type: 'pie',
                data: {
                    labels: ['Despesas Essenciais', 'Gastos Sup√©rfluos', 'Poupan√ßa/Dispon√≠vel'],
                    datasets: [{
                        data: [
                            financialData.essentials,
                            financialData.nonEssentials,
                            financialData.remaining
                        ],
                        backgroundColor: ['#33808d', '#e68161', '#32b8c6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gr√°fico de compara√ß√£o
            const comparisonCtx = document.getElementById('comparisonChart');
            if (charts.comparison) charts.comparison.destroy();

            charts.comparison = new Chart(comparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['Essenciais', 'Poupan√ßa', 'Sup√©rfluos'],
                    datasets: [
                        {
                            label: 'Actual (%)',
                            data: [
                                financialData.essentialsPercent,
                                financialData.savingsPercent,
                                financialData.nonEssentialsPercent
                            ],
                            backgroundColor: '#33808d'
                        },
                        {
                            label: 'Recomendado (%)',
                            data: [70, 20, 10],
                            backgroundColor: '#32b8c6'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function generateAdvice() {
            const adviceList = document.getElementById('advice-list');
            const advice = [];

            if (financialData.remaining < 0) {
                advice.push({
                    type: 'warning',
                    text: `‚ö†Ô∏è ATEN√á√ÉO: Est√° a gastar mais do que ganha! D√©fice de ‚Ç¨${Math.abs(financialData.remaining).toFixed(2)} por m√™s.`
                });
            } else if (financialData.savingsPercent < 10) {
                advice.push({
                    type: 'warning',
                    text: `üí° A sua taxa de poupan√ßa √© muito baixa (${financialData.savingsPercent.toFixed(1)}%). Tente poupar pelo menos 20% do seu ordenado.`
                });
            } else if (financialData.savingsPercent >= 20) {
                advice.push({
                    type: 'success',
                    text: `‚úÖ Excelente! Est√° a poupar ${financialData.savingsPercent.toFixed(1)}% do seu ordenado. Continue assim!`
                });
            }

            if (financialData.nonEssentialsPercent > 15) {
                advice.push({
                    type: 'warning',
                    text: `üìâ Est√° a gastar ${financialData.nonEssentialsPercent.toFixed(1)}% em gastos sup√©rfluos. Tente reduzir para 10% para aumentar as poupan√ßas.`
                });
                const savings = (financialData.nonEssentialsPercent - 10) / 100 * financialData.salary;
                advice.push({
                    type: 'normal',
                    text: `üí∞ Se reduzir os gastos sup√©rfluos para 10%, pode poupar mais ‚Ç¨${savings.toFixed(2)} por m√™s (‚Ç¨${(savings * 12).toFixed(2)} por ano).`
                });
            }

            if (financialData.essentialsPercent > 70) {
                advice.push({
                    type: 'warning',
                    text: `üè† As suas despesas essenciais representam ${financialData.essentialsPercent.toFixed(1)}% do ordenado. Considere formas de reduzir custos fixos.`
                });
            }

            if (financialData.remaining > 0) {
                const monthlyInvestment = financialData.remaining * 0.5;
                const annualInvestment = monthlyInvestment * 12;
                advice.push({
                    type: 'success',
                    text: `üìä Sugest√£o: Invista ‚Ç¨${monthlyInvestment.toFixed(2)} por m√™s (50% da sobra). Em um ano ter√° investido ‚Ç¨${annualInvestment.toFixed(2)}.`
                });

                const monthlySavings = financialData.remaining * 0.3;
                const annualSavings = monthlySavings * 12;
                advice.push({
                    type: 'success',
                    text: `üè¶ Reserve ‚Ç¨${monthlySavings.toFixed(2)} para poupan√ßas de emerg√™ncia. Em um ano ter√° ‚Ç¨${annualSavings.toFixed(2)} guardados.`
                });
            }

            adviceList.innerHTML = advice.map(item => `
                <li class="advice-item ${item.type}">${item.text}</li>
            `).join('');
        }

        // Gest√£o de Despesas
        function addExpense() {
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const category = document.getElementById('expense-category').value;
            const date = document.getElementById('expense-date').value;

            if (!description || !amount || !date) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            const expense = {
                id: Date.now(),
                description,
                amount,
                category,
                date
            };

            expenses.push(expense);
            updateExpenseList();
            updateExpenseChart();

            // Limpar formul√°rio
            document.getElementById('expense-description').value = '';
            document.getElementById('expense-amount').value = '';
        }

        function deleteExpense(id) {
            expenses = expenses.filter(e => e.id !== id);
            updateExpenseList();
            updateExpenseChart();
        }

        function updateExpenseList() {
            const expenseList = document.getElementById('expense-list');
            const total = expenses.reduce((sum, e) => sum + e.amount, 0);

            if (expenses.length === 0) {
                expenseList.innerHTML = '<p style="text-align: center; color: var(--color-text-secondary);">Nenhuma despesa registada ainda.</p>';
            } else {
                expenseList.innerHTML = expenses
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .map(expense => `
                        <div class="expense-item">
                            <div class="expense-info">
                                <div class="expense-category">${expense.description}</div>
                                <div class="expense-date">${expense.category} ‚Ä¢ ${new Date(expense.date).toLocaleDateString('pt-PT')}</div>
                            </div>
                            <div class="expense-amount">‚Ç¨${expense.amount.toFixed(2)}</div>
                            <button class="btn btn-danger btn-small" onclick="deleteExpense(${expense.id})">‚úï</button>
                        </div>
                    `).join('');
            }

            document.getElementById('total-expenses').textContent = `‚Ç¨${total.toFixed(2)}`;
        }

        function updateExpenseChart() {
            const ctx = document.getElementById('expenseChart');
            
            const categoryTotals = {};
            expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });

            if (charts.expenses) charts.expenses.destroy();

            if (Object.keys(categoryTotals).length === 0) {
                return;
            }

            charts.expenses = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryTotals),
                    datasets: [{
                        data: Object.values(categoryTotals),
                        backgroundColor: [
                            '#33808d', '#e68161', '#32b8c6', '#c0152f', 
                            '#626c71', '#1d7480', '#a8522f'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Gest√£o de Objetivos
        function addGoal() {
            const name = document.getElementById('goal-name').value;
            const amount = parseFloat(document.getElementById('goal-amount').value);
            const saved = parseFloat(document.getElementById('goal-saved').value) || 0;
            const monthly = parseFloat(document.getElementById('goal-monthly').value);
            const deadline = document.getElementById('goal-deadline').value;

            if (!name || !amount || !monthly || !deadline) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }

            const remaining = amount - saved;
            const monthsNeeded = Math.ceil(remaining / monthly);
            const deadlineDate = new Date(deadline);
            const today = new Date();
            const monthsAvailable = Math.round((deadlineDate - today) / (1000 * 60 * 60 * 24 * 30));

            const goal = {
                id: Date.now(),
                name,
                amount,
                saved,
                monthly,
                deadline,
                remaining,
                monthsNeeded,
                monthsAvailable,
                achievable: monthsNeeded <= monthsAvailable
            };

            goals.push(goal);
            updateGoalsList();

            // Limpar formul√°rio
            document.getElementById('goal-name').value = '';
            document.getElementById('goal-amount').value = '';
            document.getElementById('goal-saved').value = '';
            document.getElementById('goal-monthly').value = '';
            document.getElementById('goal-deadline').value = '';
        }

        function deleteGoal(id) {
            goals = goals.filter(g => g.id !== id);
            updateGoalsList();
        }

        function updateGoalsList() {
            const goalsList = document.getElementById('goals-list');

            if (goals.length === 0) {
                goalsList.innerHTML = '<p style="text-align: center; color: var(--color-text-secondary);">Nenhum objetivo definido ainda.</p>';
                return;
            }

            goalsList.innerHTML = goals.map(goal => {
                const progress = (goal.saved / goal.amount) * 100;
                return `
                    <div class="goal-card">
                        <div class="goal-header">
                            <div class="goal-name">${goal.name}</div>
                            <button class="btn btn-danger btn-small" onclick="deleteGoal(${goal.id})">‚úï</button>
                        </div>
                        <div class="goal-progress">
                            ‚Ç¨${goal.saved.toFixed(2)} de ‚Ç¨${goal.amount.toFixed(2)} (${progress.toFixed(1)}%)
                        </div>
                        <div class="percentage-bar">
                            <div class="percentage-fill" style="width: ${progress}%"></div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: var(--color-text-secondary);">
                            <div>üí∞ Falta: ‚Ç¨${goal.remaining.toFixed(2)}</div>
                            <div>üìÖ Prazo: ${new Date(goal.deadline).toLocaleDateString('pt-PT')}</div>
                            <div>üìä Com ‚Ç¨${goal.monthly.toFixed(2)}/m√™s ‚Üí ${goal.monthsNeeded} meses</div>
                            ${goal.achievable 
                                ? '<div class="positive">‚úÖ Objetivo alcan√ß√°vel no prazo!</div>'
                                : '<div class="negative">‚ö†Ô∏è Precisa poupar mais por m√™s para alcan√ßar no prazo</div>'
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Proje√ß√µes
        function updateProjections() {
            if (!financialData) {
                return;
            }

            const annualIncome = financialData.salary * 12;
            const annualExpenses = financialData.totalExpenses * 12;
            const annualSavings = financialData.remaining * 12 * 0.7; // 70% para poupan√ßa
            const annualInvestment = financialData.remaining * 12 * 0.3; // 30% para investimento

            document.getElementById('proj-income').textContent = `‚Ç¨${annualIncome.toFixed(2)}`;
            document.getElementById('proj-expenses').textContent = `‚Ç¨${annualExpenses.toFixed(2)}`;
            document.getElementById('proj-savings').textContent = `‚Ç¨${annualSavings.toFixed(2)}`;
            document.getElementById('proj-investment').textContent = `‚Ç¨${annualInvestment.toFixed(2)}`;

            // Tabela mensal
            const tbody = document.getElementById('projection-table-body');
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            let accumulated = 0;

            tbody.innerHTML = months.map((month, i) => {
                accumulated += financialData.remaining;
                return `
                    <tr>
                        <td>${month}</td>
                        <td class="positive">‚Ç¨${financialData.salary.toFixed(2)}</td>
                        <td class="negative">‚Ç¨${financialData.totalExpenses.toFixed(2)}</td>
                        <td class="positive">‚Ç¨${financialData.remaining.toFixed(2)}</td>
                        <td class="positive"><strong>‚Ç¨${accumulated.toFixed(2)}</strong></td>
                    </tr>
                `;
            }).join('');

            // Gr√°fico de proje√ß√£o
            createProjectionChart(months, accumulated);
        }

        function createProjectionChart(months, finalAmount) {
            const ctx = document.getElementById('projectionChart');
            if (charts.projection) charts.projection.destroy();

            const data = [];
            let acc = 0;
            for (let i = 0; i < 12; i++) {
                acc += financialData.remaining;
                data.push(acc);
            }

            charts.projection = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Saldo Acumulado (‚Ç¨)',
                        data: data,
                        borderColor: '#33808d',
                        backgroundColor: 'rgba(51, 128, 141, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Simulador
        function runSimulation() {
            if (!financialData) {
                alert('Por favor, preencha os dados iniciais primeiro.');
                showTab('input');
                return;
            }

            const salaryChange = parseFloat(document.getElementById('sim-salary-change').value) || 0;
            const expenseChange = parseFloat(document.getElementById('sim-expense-change').value) || 0;
            const newExpense = parseFloat(document.getElementById('sim-new-expense').value) || 0;
            const months = parseInt(document.getElementById('sim-months').value) || 12;

            const newSalary = financialData.salary * (1 + salaryChange / 100);
            const newExpenses = financialData.totalExpenses * (1 + expenseChange / 100) + newExpense;
            const newRemaining = newSalary - newExpenses;

            const currentTotal = financialData.remaining * months;
            const newTotal = newRemaining * months;
            const difference = newTotal - currentTotal;

            document.getElementById('sim-current').textContent = `‚Ç¨${currentTotal.toFixed(2)}`;
            document.getElementById('sim-new').textContent = `‚Ç¨${newTotal.toFixed(2)}`;
            document.getElementById('sim-diff').textContent = `‚Ç¨${difference.toFixed(2)}`;
            
            const diffElement = document.getElementById('sim-diff');
            diffElement.className = `stat-value ${difference >= 0 ? 'positive' : 'negative'}`;

            document.getElementById('simulation-results').classList.remove('hidden');

            // Gr√°fico de simula√ß√£o
            createSimulationChart(months, currentTotal, newTotal);

            // An√°lise
            generateSimulationAdvice(salaryChange, expenseChange, newExpense, difference, months);
        }

        function createSimulationChart(months, currentTotal, newTotal) {
            const ctx = document.getElementById('simulationChart');
            if (charts.simulation) charts.simulation.destroy();

            const labels = [];
            const currentData = [];
            const newData = [];

            let currentAcc = 0;
            let newAcc = 0;

            for (let i = 1; i <= months; i++) {
                labels.push(`M√™s ${i}`);
                currentAcc += financialData.remaining;
                currentData.push(currentAcc);
                
                const newRemaining = (financialData.salary * (1 + parseFloat(document.getElementById('sim-salary-change').value || 0) / 100)) -
                                    (financialData.totalExpenses * (1 + parseFloat(document.getElementById('sim-expense-change').value || 0) / 100) +
                                     parseFloat(document.getElementById('sim-new-expense').value || 0));
                newAcc += newRemaining;
                newData.push(newAcc);
            }

            charts.simulation = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Cen√°rio Actual',
                            data: currentData,
                            borderColor: '#626c71',
                            backgroundColor: 'rgba(98, 108, 113, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Novo Cen√°rio',
                            data: newData,
                            borderColor: '#33808d',
                            backgroundColor: 'rgba(51, 128, 141, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function generateSimulationAdvice(salaryChange, expenseChange, newExpense, difference, months) {
            const adviceDiv = document.getElementById('simulation-advice');
            const advice = [];

            if (salaryChange !== 0) {
                advice.push(`üìä Com um ${salaryChange > 0 ? 'aumento' : 'redu√ß√£o'} de ${Math.abs(salaryChange)}% no ordenado...`);
            }

            if (expenseChange !== 0) {
                advice.push(`üí∞ Com uma ${expenseChange > 0 ? 'aumento' : 'redu√ß√£o'} de ${Math.abs(expenseChange)}% nas despesas...`);
            }

            if (newExpense > 0) {
                advice.push(`‚ûï Adicionando uma nova despesa de ‚Ç¨${newExpense.toFixed(2)}/m√™s...`);
            }

            if (difference > 0) {
                advice.push(`‚úÖ Este cen√°rio resulta em mais ‚Ç¨${difference.toFixed(2)} poupados em ${months} meses!`);
                advice.push(`üí° Isso representa ‚Ç¨${(difference / months).toFixed(2)} extra por m√™s.`);
            } else if (difference < 0) {
                advice.push(`‚ö†Ô∏è Este cen√°rio resulta em menos ‚Ç¨${Math.abs(difference).toFixed(2)} poupados em ${months} meses.`);
                advice.push(`üìâ Voc√™ perder√° ‚Ç¨${(Math.abs(difference) / months).toFixed(2)} por m√™s com estas mudan√ßas.`);
            } else {
                advice.push(`‚û°Ô∏è Este cen√°rio n√£o altera significativamente as suas finan√ßas.`);
            }

            adviceDiv.innerHTML = advice.map(text => `<p style="margin-bottom: 10px;">${text}</p>`).join('');
        }
    </script>
</body>
</html>
